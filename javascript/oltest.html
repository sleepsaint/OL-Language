<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>OL test</title>
	<script src="ol.js"></script>
	<script>
	function test_parse() {
		var test = [
			"#(abd,bdf)",
			"(abd, adfsdf, asdfd, ",
			"!(abd, !@.123.abd.{@.abd}.(~.abc,daf, $12.4) )",
			"!(abd, !@.123.abd.{@.abd}.(~.abc,daf, $12.4)",
			"!()",
			"!(abd, !@.123.abd.{@.abd}.)",
			"(abd, !@.123.abd.$123.{@.abd})",
			"(abd, sdfe",
			"(abd, !@.123.abd.123.{@.abd.{~.abd})",
			"(abd, !@.123.abd.123.{@.abd.{.abd})",
			"(abd, !)"
		]
		for (var i in test) {
			var a = OL.parse(test[i]);
			if (a) {
				console.log(a.debug());
			}
		}
	}
	
	var root = {
		person: {
			P0001: {name: "Tom", age:30, wear: {hat:"W0001", upper: "W0002", under: "W0003", shoes: null}},
			P0002: {name: "May", age:25, wear: {hat:"W0004", upper: "W0005", under: "W0006", shoes: "W0007"}},
		},
		wear: {
			W0001: {name: "Red Hat", price: 100},
			W0002: {name: "White Jacket", price: 200},
			W0003: {name: "Black Shorts", price: 50},
			W0004: {name: "White Hat", price: 210},
			W0005: {name: "Red Jacket", price: 220},
			W0006: {name: "White Skirt", price: 60},
			W0007: {name: "Red HHS", price: 10},
		}
	};
	var temp = {
		person: "P0001",
		person2: "^.person.P0001",
		wearnow: "upper",
		personwear: "^.wear.{~.person2.wear.{~.wearnow}}",
		wearfilter1: "#(>, @.price, 150)",
		wearsorter1: "#(!(=,@.name,Red Hat),!@.price))",
		now: "^.wear",
	};
	
	function test_lookup(source, now) {
		console.log(source)
		console.log(OL.parse(source).lookup(root, temp, now));
	}
	
	function test2() {
		test_lookup("^.wear.{^.person.{~.person}.wear.hat}.price");
		test_lookup("^.wear.{~.person2.wear.hat}.price");
		test_lookup("~.personwear.price");
		test_lookup("(-, (+, ^.wear.W0001.price, ^.wear.W0002.price), ^.wear.W0002.price)");
		test_lookup("(filter, ^.wear, #(>, @.price, 150))");
		test_lookup("(filter, ^.wear, ~.wearfilter1)");
		test_lookup("(or, !(>,^.wear.W0001.price,50), (>, ^.wear.W0002.price, 100) )");
		test_lookup("(sort, ^.wear, #(@.price))");
		test_lookup("(sort, ^.wear, #(!(=,@.name,Red Hat),@.price))");
		test_lookup("(sort, ^.wear, ~.wearsorter1)");
		test_lookup("(some, ^.wear, ~.wearfilter1)");
		test_lookup("(sort, ~.now, ~.wearsorter1)");
	}
	
	
	function test() {
		test_parse();
		// test2();
	}
	</script>
</head>
<body id="oltest" onload="test()">
	See result in console.
</body>
</html>